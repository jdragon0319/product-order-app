# Product-Order-Application

상품 주문 프로그램

# 사용기술

- Java 17
- Spring Boot 3.2.4
- Spring Data Jpa
- H2

# 실행 방법

터미널에서 실행
> mvn package  
> java -jar product-order-app.jar 상품CSV파일경로  
> 예시(윈도우) : java -jar product-order-app.jar classes/product/items.csv

IntelliJ 실행
> ProductOrderAppApplication 실행
> 터미널 실행과는 다르게 Run configuration 에 파일 경로를 입력하지 않아도 됩니다  

# 기능설명

- csv 파일을 읽은 후에 상품을 DB에 저장하는 기능
- 여러개의 상품을 한번에 주문하는 기능
- 재고를 확인후 재고가 있다면 주문이 가능하고, 재고가 없으면 예외를 발생시키는 기능
- 주문금액이 5만원 미만이면 배송료 2500원 추가하는 기능

# TODO 

- [x] 기능정리
- [x] 프로그램 실행시 csv 파일을 읽는 기능 구현
- [x] csv 파일 내용을 in memory db  에 저장하는 기능 구현
- [x] 입력 문구 출력 기능 구현
- [x] o,q 입력에 분기 처리 구현
- [x] 현재 판매중인 상품목록과 재고 출력
- [x] 주문하려는 상품을 입력받는 기능 구현
- [x] 상품조회, 재고를 확인하는 기능 구현
- [x] 주문, 주문상품을 저장하는 기능 구현 
- [x] 재고감소 및 재고복구 로직 구현
- [x] 한번에 여러개의 상품을 주문하는 로직 기능 구현

# 고려사항

- 멀티스레드 환경에서 재고차감 기능을 실행했을 때 데이터를 어떻게 차감해야 하는지 고민됐습니다.
    - 낙관적락을 적용했습니다.
- 재고 차감 로직을 결제 전에 해야 하나 후에 해야 하나
    - 결제와 거의 비슷한 시간에 동시에 이루어지는게 좋아 보이지만, 일단은 재고차감을 먼저 실행하고 결제로직을 실행하게 했습니다.
    - 재고차감을 해야 다른 주문이 결제 시도하는 것을 막을 수 있을 것 같습니다.
- 재고 감소시 트랜잭션 전파 범위를 어떻게 해야 하나 고민이 됨
    - StockCommandService#deductStocks() 를 REQUIRED_NEW 로 설정하면 결제 실패시 감소시켰던 재고를 롤백할 수 없지만
      다른 주문이 결제 시도 하는 것을 막을 수 있을 것 같습니다.

